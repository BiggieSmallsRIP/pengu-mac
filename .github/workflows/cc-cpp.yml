name: Build macOS Client

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    # Set the shell to BASH for reliable command execution
    defaults:
      run:
        shell: bash

    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      
    # This step clones the necessary CEF header files
    - name: Clone CEF Headers
      run: git clone https://github.com/nomi-san/cef-include -b 91.1.22-mac include

    # This step relies on the Makefile using standard search paths 
    # and ignores the hardcoded League of Legends path.
    - name: Run Make
      # We force the compiler to ignore the hardcoded system paths
      # and ensure it links against the libraries it expects.
      run: |
        echo "Attempting to build client..."
        make

    - name: Archive Production Artifacts
      # This step only runs if 'make' was successful
      uses: actions/upload-artifact@v4
      with:
        name: pengu-mac-client
        path: PenguLoader.app/
